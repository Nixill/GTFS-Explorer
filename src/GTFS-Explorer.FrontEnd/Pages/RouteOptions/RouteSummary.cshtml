@page "{routeId}/{servicesDate:datetime?}"
@model GTFS_Explorer.FrontEnd.Pages.RouteOptions.RouteSummaryModel
@{
    ViewData["Title"] = "RouteSummary";
}

@using GTFS_Explorer.Core.Models.Structs; 

<link rel="stylesheet" href="~/css/style.css" />
<section>
    <div class="header">
        <div class="header-right">
            <a class="active"
               asp-page="/RouteOptions/RouteSummary"
               asp-route-routeId="@Model.RouteId">Summary</a>
            <a asp-page="/RouteOptions/RouteMap" 
               asp-route-routeId="@Model.RouteId">Route Map</a>
            <a asp-page="/RouteOptions/StopList"
               asp-route-routeId="@Model.RouteId">Stop List</a>
            <a asp-page="/RouteOptions/Schedule"
               asp-route-routeId="@Model.RouteId">Schedule</a>
        </div>
    </div>
    <div class="d-flex align-items-center">
        <div class="container floater"
             style="height: 560px;">
            <div class="row ml-2 mt-3 mr-2 d-flex justify-content-center">
                <div class="col-md-5 p-md-5">
                    @if (string.IsNullOrEmpty(Model.Route.Description))
                    {
                        <p class="text-light">No description provided!</p>
                    }
                    else
                    {
                        <p class="text-light">@Model.Route.Description</p>
                    }

                    @if (string.IsNullOrEmpty(Model.Route.Url))
                    {
                        <p class="text-light">No URL provided!</p>
                    }
                    else
                    {
                        <a class="text-light" id="route-link">@Model.Route.Url</a>
                    }
                </div>
                <div class="col p-2"
                     style="background-color: #EFEEED;">
					<div class="d-flex justify-content-between">
						<h5 style="color: #087983;"
							class="pt-2">
							Route Stats
						</h5>
						<form asp-page-handler="RouteStats"
                              class="d-flex justify-content-center">
							<input type="date"
								   class="form-control"
								   asp-for="ServicesDate" />
							@Html.HiddenFor(m => m.RouteId)
							<button type="submit"
									class="btn-sm button submit"
                                    style="margin-left: 10px">
								See Stats
							</button>
						</form>
					</div>
                </div>
				<div class="row">
					@foreach (var direction in Model.StatsDictionary.Keys)
					{
						RouteStats stats;
						Model.StatsDictionary.TryGetValue(direction, out stats);
					    <div class="d-block p-lg-3">
						    <h6 class="text-white">@direction.ToString()</h6>
						    <ul>
							    <li class="text-white">
                                    The route runs @stats.StartTime to @stats.EndTime
                                </li>
							    <li class="text-white">
                                    Trips start at @stats.StartStops[0]
                                </li>
								<li class="text-white">
                                    Trips end at @stats.EndStops[0]
                                </li>
								<li class="text-white">
									Trips are @stats.ShortestTrip.Minutes minutes 
									to @stats.LongestTrip.Minutes minutes 
                                    long (@stats.AverageTrip.ToString() on average)
								</li>
						    </ul>
					    </div>
					}
				</div>
            </div>
        </div>
    </div>

    <form>
        <input type="file" id="selectFile" class="hidden" />
        <label class="select-file" for="selectFile">Select New File</label>
        <a asp-page="/MainPages/Routes" id="returnToRoutes" />
        <label class="select-file" for="returnToRoutes">Return to Routes</label>
    </form>

    <script>
		window.addEventListener('load', () => {
			$('#loader').css('display', 'none');
			$('#fader').css('display', 'none');
			$('#loader-wrapper').css('display', 'none');
		});

        (function(){
            const { ipcRenderer } = require("electron");

            document.getElementById("route-link").addEventListener("click", () => {
                ipcRenderer.send("open-route-link");
            });
        }());
    </script>
</section>